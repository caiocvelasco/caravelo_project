version: 2

models:
  - name: vw_bookings_summary
    description: >
      Route-level summary by source system with segments, bookings, and passengers
      (segments ≈ seats sold on this leg).
    columns:
      - name: source_system
        description: "Data origin (Amadeus / Sabre / Vueling)."
      - name: origin
        description: "Route origin IATA."
      - name: destination
        description: "Route destination IATA."
      - name: segments
        description: "Count of passenger-flight rows (think 'seats sold on this leg')."
      - name: bookings
        description: "Distinct booking IDs (PNRs / Record Locators)."
      - name: passengers
        description: "Distinct passenger names (proxy for passenger count)."
  - name: dim_bookings
    description: "One row per booking (deduped across sources), with counts and metadata."
    columns:
      - name: booking_sk
        description: "Surrogate key = md5(source_system || '|' || booking_id)."
        tests: [not_null, unique]     # <— primary integrity tests
      - name: booking_id
        description: "Natural booking reference from source."
        tests: [not_null]
      - name: source_system
        description: "Originating system (Amadeus / Sabre / Vueling)."
        tests: [not_null]
  - name: dim_client
    description: "Client dimension (from JSON config)."
    columns:
      - name: client_code
        description: "Tenant code."
        tests: [not_null, unique]
      - name: client_name
        description: "Display name."
      - name: reporting_timezone
        description: "IANA timezone for recognition logic."
        tests: [not_null]
      - name: reporting_currency
        description: "Client’s base reporting currency."
        tests: [not_null]
  - name: fct_mrr_alloc
    description: >
      Monthly-recognized subscription revenue normalized to a monthly basis, per
      client × subscription × recognition_month. Includes native, EUR, and client reporting currency.
    columns:
      - name: client_code
        description: "Tenant code (FK to dim_client)."
        tests:
          - not_null
      - name: subscription_id
        description: "Subscription identifier."
        tests: [not_null]
      - name: recognition_month
        description: "Month to which revenue is recognized (client timezone)."
        tests: [not_null]
      - name: billing_period
        description: "MONTHLY / QUARTERLY / ANNUAL."
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ["MONTHLY","QUARTERLY","ANNUAL"]
      - name: currency_native
        description: "Original currency of the charge."
        tests: [not_null]
      - name: mrr_native
        description: "Monthly-recognized amount in native currency."
        tests: [not_null]
      - name: mrr_eur
        description: "Monthly MRR converted to EUR using monthly FX."
        tests: [not_null]
      - name: mrr_reporting_currency
        description: "Monthly MRR in client's base reporting currency."
      - name: eur_per_unit_native
        description: "EUR per 1 unit of native currency (FX used)."
      - name: eur_per_unit_reporting
        description: "EUR per 1 unit of reporting currency (FX used)."
  - name: mart_customer__mrr_monthly
    description: "Customer-facing monthly MRR by client in their reporting currency."
    columns:
      - name: client_code
        description: "Tenant code."
        tests: [not_null]
      - name: recognition_month
        description: "Recognized month."
        tests: [not_null]
      - name: mrr_reporting_currency
        description: "Aggregated MRR in client's reporting currency."
  - name: mart_internal__mrr_monthly_eur
    description: "Internal consolidated monthly MRR in EUR."
    columns:
      - name: recognition_month
        description: "Recognized month."
        tests: [not_null]
      - name: mrr_eur
        description: "Aggregated MRR in EUR."

